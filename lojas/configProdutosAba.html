<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevFood</title>
    <!-- <link rel="stylesheet" href="styles.css"> -->
    <!-- Bootstrap Links -->
    

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <!-- JS, Popper.js, and jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>


    <!-- Jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

    <!--    &lt;!&ndash; for handle Bar &ndash;&gt;-->
    <script src="https://twitter.github.io/typeahead.js/js/handlebars.js"></script>

    <!--Semantics Ui CDN  -->
    <!--    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">-->
    <!--    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>-->

    <!-- select2 -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            background-color: #f5f5f5;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 250px;
            height: 100vh;
            background-color: #fff;
            padding: 15px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            /* Caso tenha muitas op√ß√µes no menu */
        }


        .sidebar h2 {
            color: #ff0000;
        }

        .sidebar .store-status {
            background: red;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
        }

        .sidebar ul li {
            padding: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar ul li.active {
            font-weight: bold;
            color: red;
        }

        .new-badge {
            background: red;
            color: white;
            padding: 3px 6px;
            font-size: 10px;
            border-radius: 5px;
            margin-left: auto;
        }

        .notification {
            background: red;
            color: white;
            font-size: 12px;
            padding: 2px 5px;
            border-radius: 50%;
        }

        .main-content {
            margin-left: 250px;
            /* Igual ao width da sidebar */
            flex: 1;
            padding: 20px;
        }


        header {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #ddd;
            margin-bottom: 20px;
        }

        .tabs div {
            padding: 10px 20px;
            cursor: pointer;
        }

        .tabs .active {
            border-bottom: 2px solid red;
            color: red;
        }

        .replication-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .replication-header a {
            color: green;
            text-decoration: none;
            font-weight: bold;
        }

        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }

        .search-bar input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .button {
            background: rgb(40, 129, 12);
            color: white;
            padding: 10px;

            border: none;
            cursor: pointer;
            border-radius: 5px;

        }

        .list_produtos {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            text-align: left;
        }

        th {
            background: #fafafa;
        }

        .status {
            color: green;
            font-weight: bold;
        }

        .status-icon {
            color: green;
            font-size: 16px;
            margin-left: 5px;
        }

        .label {
            background: red;
            color: white;
            padding: 3px 6px;
            border-radius: 5px;
            font-size: 12px;
        }

        .labelEdit {
            background: red;
            color: white;
            padding: 3px 6px;
            border-radius: 5px;
            font-size: 12px;
        }


        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: #fff;
            padding: 50px;
            border-radius: 8px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            width: 500px;
            max-width: 90%;
            text-align: center;
        }

        .modal-content h2 {
            color: red;
            margin-bottom: 20px;
        }

        .modal-content form {
            display: grid;

            gap: 3px;
            text-align: left;

        }

        .modal-content form label {
            grid-template-rows: span 2;
            margin-right: 10px;

        }

        .modal-content form input[type="file"],
        .modal-content form input[type="text"],
        .modal-content form input[type="number"] {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .modalEdit {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        .modalEdit-content {
            background-color: #fff;
            padding: 50px;
            border-radius: 8px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            width: 500px;
            max-width: 90%;
            text-align: center;
        }

        .modalEdit-content h2 {
            color: red;
            margin-bottom: 20px;
        }

        .modalEdit-content form {
            display: grid;

            gap: 3px;
            text-align: left;

        }

        .modalEdit-content form label {
            grid-template-rows: span 2;
            margin-right: 10px;

        }

        .modalEdit-content form input[type="file"],
        .modalEdit-content form input[type="text"],
        .modalEdit-content form input[type="number"] {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        #category-select {
            width: 106%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;

        }

        #category-select-edit {
            width: 106%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;

        }

        .modal-buttons {
            grid-column: span 2;
            display: flex;
            justify-content: right;

        }

        .button-open-modal {
            background-color: red;
            color: white;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            border-radius: 5px;

        }

        .button-open-modal-verde {
            background-color: rgb(77, 255, 0);
            color: rgb(0, 0, 0);
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            border-radius: 5px;

        }

        .submit-button,
        .cancel-button {
            padding: 10px 15px;
            border-radius: 5px;
            border: none;
            margin: 4px;
        }

        .submit-button {
            background-color: red;
            color: white;
        }

        .cancel-button {
            background-color: #aaa;
            color: white;
        }

        a {
            text-decoration: none;
            color: black;
        }

        .store-selection {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .store-selection label {
            font-weight: bold;
        }

        .store-selection select {
            width: 100%;
            max-width: 300px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            background-color: white;
            cursor: pointer;
            outline: none;
            transition: border-color 0.3s;
        }

        .store-selection select:focus {
            border-color: red;
        }

        .hidden {
            display: none;
        }

        table img {
            max-width: 70px !important;
            /* Defina um tamanho m√°ximo */
            height: auto;
            /* Mant√©m a propor√ß√£o */
            display: block;
            margin: auto;
            border-radius: 5px;
        }

        .select2-container {
            display: inline !important;
        }
    </style>
</head>

<body>
    <div id="sidebar-container"></div>
    <div class="main-content">
        <header>
            <h1>Produtos</h1>
            <p>Cadastre produtos a sua loja aqui</p>
        </header>
        <div class="store-selection">
            <label for="store-select">Escolha uma loja:</label>
            <select id="store-select">
                <option value="">Selecione uma loja</option>

            </select>
        </div>
        <div id="product-section" class="hidden">
            <div class="tabs">

                <div class="active">Produtos</div>
            </div>
            <div class="search-bar">
                <button class="button-open-modal" onclick="openModal()">Cadastrar Produto</button>
                <input type="text" placeholder="Buscar por um produto">
            </div>
            <div id="modalProdutoNovo" class="modal">
                <div class="modal-content">
                    <h2>Cadastrar Novo Produto</h2>
                    <form>
                        <label for="imagem">Imagem:</label>
                        <input type="text" id="imagemUrl" name="imagemUrl" placeholder="Imagem do produto" required>

                        <label for="nome">Nome:</label>
                        <input type="text" id="nome" name="nome" placeholder="Nome do produto" required>
                        <label for="categoria">Categoria:</label>
                        <!-- <select id="modalCategoria" class="form-control select2" multiple></select> -->

                        <label for="valor">Valor:</label>
                        <input type="number" id="valor" name="valor" placeholder="Valor" step="0.01" required>

                        <label for="estoque">Estoque:</label>
                        <input type="number" id="estoque" name="estoque" placeholder="Quantidade em estoque" required>

                        <div class="modal-buttons">
                            <button type="submit" class="submit-button">Enviar</button>
                            <button type="button" class="cancel-button">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>

            <table class="table table-bordered table-striped">
                <tr>
                    <th>Imagem</th>
                    <th>Nome</th>
                    <th>Categoria</th>
                    <th>Valor</th>
                    <th>Estoque</th>
                    <th>A√ß√µes</th>
                </tr>
                <tbody id="tabelaProdutos">
                    <tr>
                        <td colspan="6" class="text-center">Selecione uma loja para ver os produtos.</td>
                    </tr>
                </tbody>
            </table>

            <div class="modal fade" id="modalEditarProduto" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <!-- Toast de Sucesso -->
                        <div id="toastSuccess"
                            class="toast align-items-center text-bg-success border-0 position-fixed bottom-0 end-0 p-3"
                            role="alert" aria-live="polite" aria-atomic="true" style="z-index: 1050;">
                            <div class="d-flex">
                                <div class="toast-body">
                                    Produto editado com sucesso!
                                </div>
                                <button type="button" class="btn-close btn-close-white me-2 m-auto"
                                    data-bs-dismiss="toast" aria-label="Close"></button>
                            </div>
                        </div>

                        <div class="modal-header">
                            <h5 class="modal-title">Editar Produto Existente</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" id="modalProdutoId">

                            <div class="row">

                                <div class="col">

                                    <label>Imagem:</label>
                                    <input type="text" id="modalImagem" class="form-control"
                                        placeholder="Imagem do produto">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">

                                    <label>Nome:</label>
                                    <input type="text" id="modalNome" class="form-control"
                                        placeholder="Nome do produto">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">

                                    <label for="modalCategoria">Categoria:</label>
                                    <select id="modalCategoria" class="form-control js-example-basic-multiple"
                                        name="categorias[]" multiple="multiple">
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">

                                    <label>Valor:</label>
                                    <input type="text" id="modalValor" class="form-control" placeholder="Valor">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">

                                    <label>Estoque:</label>
                                    <input type="text" id="modalEstoque" class="form-control"
                                        placeholder="Quantidade em estoque">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">

                                    <label>Descri√ß√£o:</label>
                                    <textarea id="modalDescricao" class="form-control"></textarea>

                                </div>
                            </div>


                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-danger" onclick="salvarEdicaoProduto()">Enviar</button>
                            <button type="button"  class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                document.addEventListener("DOMContentLoaded", function () {


                    const selectLojas = document.getElementById('store-select');

                    // Fazendo a requisi√ß√£o para a API de lojas
                    fetch("http://127.0.0.1:8000/api/lojas/list")
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`Erro ao buscar lojas: ${response.status}`);
                            }
                            return response.json();
                        })
                        .then(data => {
                            if (!Array.isArray(data)) {
                                throw new Error("Formato de resposta inv√°lido da API");
                            }

                            data.forEach(loja => {
                                let option = document.createElement('option');
                                option.value = loja.id;
                                option.textContent = loja.nome_fantasia;
                                selectLojas.appendChild(option);
                            });
                        })
                        .catch(error => {
                            console.error("Erro ao carregar lojas:", error);
                        });


                    // Evento para capturar a loja selecionada e buscar produtos
                    selectLojas.addEventListener("change", function () {
                        const lojaId = this.value;

                        if (lojaId) {
                            buscarProdutos(lojaId);
                        } else {
                            tabelaProdutos.innerHTML = "<tr><td colspan='6' class='text-center'>Selecione uma loja para ver os produtos.</td></tr>";
                        }
                    });

                    // Fun√ß√£o para buscar produtos da loja selecionada
                    function buscarProdutos(lojaId) {
                        fetch(`http://127.0.0.1:8000/api/lojas/${lojaId}/produtos`)
                            .then(response => response.json())
                            .then(produtos => {
                                tabelaProdutos.innerHTML = ""; // Limpa a tabela anterior
                                produtoList = produtos

                                if (produtos.length === 0) {
                                    tabelaProdutos.innerHTML = "<tr><td colspan='6' class='text-center'>Nenhum produto encontrado para esta loja.</td></tr>";
                                    return;
                                }

                                produtos.forEach(produto => {
                                    let tr = document.createElement('tr');

                                    let imagemTd = document.createElement('td');
                                    let img = document.createElement('img');
                                    img.src = produto.imagem ? produto.imagem : '0';
                                    img.alt = produto.nome;
                                    img.classList.add("img-thumbnail");
                                    imagemTd.appendChild(img);

                                    let nomeTd = document.createElement('td');
                                    nomeTd.textContent = produto.nome;

                                    let categoriaTd = document.createElement('td');

                                    if (produto.categoria && produto.categoria.length > 0) {
                                        categoriaTd.textContent = produto.categoria.map(cat => cat.name).join(', ');
                                    } else {
                                        categoriaTd.textContent = 'Sem Categoria';
                                    }

                                    let precoTd = document.createElement('td');
                                    precoTd.textContent = `R$ ${parseFloat(produto.valor_unitario).toFixed(2)}`;

                                    // üîπ Coluna do Estoque - Agora acessamos `produto.estoque`
                                    let estoqueTd = document.createElement('td');
                                    estoqueTd.textContent = (produto.estoque[0] && produto.estoque[0].quantidade !== undefined)
                                        ? produto.estoque[0].quantidade
                                        : 'Indefinido';
                                    // console.log(produto);

                                    let acoesTd = document.createElement('td');
                                    acoesTd.innerHTML = `
                                <button class="btn btn-success btn-sm me-2" onclick="openModalEdit(${produto.id})">Editar</button>
                                <button class="btn btn-danger btn-sm" onclick="excluirProduto(${produto.id})">Excluir</button>
                            `;

                                    // Adiciona as c√©lulas √† linha
                                    tr.appendChild(imagemTd);
                                    tr.appendChild(nomeTd);
                                    tr.appendChild(categoriaTd);
                                    tr.appendChild(precoTd);
                                    tr.appendChild(estoqueTd);
                                    tr.appendChild(acoesTd);

                                    // Adiciona a linha √† tabela
                                    tabelaProdutos.appendChild(tr);
                                });
                            })
                            .catch(error => {
                                console.error("Erro ao carregar produtos:", error);
                                tabelaProdutos.innerHTML = "<tr><td colspan='6' class='text-center'>Erro ao carregar produtos.</td></tr>";
                            });
                    }





                })
                // Fun√ß√£o para buscar produtos da loja selecionada
                function buscarProdutoss(lojaId) {
                    fetch(`http://127.0.0.1:8000/api/lojas/${lojaId}/produtos`)
                        .then(response => response.json())
                        .then(produtos => {
                            tabelaProdutos.innerHTML = ""; // Limpa a tabela anterior
                            produtoList = produtos

                            if (produtos.length === 0) {
                                tabelaProdutos.innerHTML = "<tr><td colspan='6' class='text-center'>Nenhum produto encontrado para esta loja.</td></tr>";
                                return;
                            }

                            produtos.forEach(produto => {
                                let tr = document.createElement('tr');

                                let imagemTd = document.createElement('td');
                                let img = document.createElement('img');
                                img.src = produto.imagem ? produto.imagem : '';
                                img.alt = produto.nome;
                                img.classList.add("img-thumbnail");
                                imagemTd.appendChild(img);

                                let nomeTd = document.createElement('td');
                                nomeTd.textContent = produto.nome;

                                let categoriaTd = document.createElement('td');

                                if (produto.categoria && produto.categoria.length > 0) {
                                    categoriaTd.textContent = produto.categoria.map(cat => cat.name).join(', ');
                                } else {
                                    categoriaTd.textContent = 'Sem Categoria';
                                }

                                let precoTd = document.createElement('td');
                                precoTd.textContent = `R$ ${parseFloat(produto.valor_unitario).toFixed(2)}`;

                                // üîπ Coluna do Estoque - Agora acessamos `produto.estoque`
                                let estoqueTd = document.createElement('td');
                                estoqueTd.textContent = (produto.estoque[0] && produto.estoque[0].quantidade !== undefined)
                                    ? produto.estoque[0].quantidade
                                    : 'Indefinido';
                                // console.log(produto);

                                let acoesTd = document.createElement('td');
                                acoesTd.innerHTML = `
                                <button class="btn btn-success btn-sm me-2" onclick="openModalEdit(${produto.id})">Editar</button>
                                <button class="btn btn-danger btn-sm" onclick="excluirProduto(${produto.id})">Excluir</button>
                            `;

                                // Adiciona as c√©lulas √† linha
                                tr.appendChild(imagemTd);
                                tr.appendChild(nomeTd);
                                tr.appendChild(categoriaTd);
                                tr.appendChild(precoTd);
                                tr.appendChild(estoqueTd);
                                tr.appendChild(acoesTd);

                                // Adiciona a linha √† tabela
                                tabelaProdutos.appendChild(tr);
                            });
                        })
                        .catch(error => {
                            console.error("Erro ao carregar produtos:", error);
                            tabelaProdutos.innerHTML = "<tr><td colspan='6' class='text-center'>Erro ao carregar produtos.</td></tr>";
                        });
                }

                $(document).ready(function () {
                    let categoriaSelect = $("#modalCategoria");

                    // Inicializa o Select2 com busca interna
                    categoriaSelect.select2({
                        placeholder: "Selecione categorias...",
                        allowClear: true,
                        closeOnSelect: false
                    });

                    // üîπ Busca as categorias do banco de dados e adiciona ao Select2
                    fetch("http://127.0.0.1:8000/api/categories/list")
                        .then(response => response.json())
                        .then(data => {
                            // console.log("Categorias carregadas:", data);

                            if (!data || data.length === 0) {
                                console.warn("Nenhuma categoria encontrada!");
                                return;
                            }

                            // üîπ Remove todas as op√ß√µes anteriores
                            categoriaSelect.empty();

                            // üîπ Adiciona as categorias ao Select2
                            data.forEach(cat => {
                                let option = new Option(cat.name, cat.id, false, false);
                                categoriaSelect.append(option);
                            });

                            // üîπ Atualiza o Select2 para exibir todas as categorias carregadas
                            categoriaSelect.trigger("change");
                        })
                        .catch(error => console.error("Erro ao carregar categorias:", error));
                });









                let produtoList = []
                // Fun√ß√£o para abrir o modal de edi√ß√£o (exemplo)
                function openModalEdit(produtoId) {
                    // console.log("Abrindo modal para o produto ID:", produtoId);

                    let produto = produtoList.find(p => p.id === produtoId);
                    if (!produto) {
                        alert("Erro: Produto n√£o encontrado!");
                        return;
                    }

                    // Preenche os campos do modal
                    document.getElementById('modalNome').value = produto.nome || '';
                    document.getElementById('modalValor').value = produto.valor_unitario || '';
                    document.getElementById('modalDescricao').value = produto.descricao || '';
                    document.getElementById('modalImagem').value = produto.imagem || '';
                    document.getElementById('modalProdutoId').value = produto.id;

                    // Preencher estoque (se dispon√≠vel)
                    document.getElementById('modalEstoque').value =
                        (produto.estoque && produto.estoque.length > 0) ? produto.estoque[0].quantidade : '';

                    let categoriaSelect = $("#modalCategoria");
                    categoriaSelect.val([]).trigger("change"); // Limpa sele√ß√µes anteriores

                    if (produto.categoria && produto.categoria.length > 0) {
                        let categoriasSelecionadas = produto.categoria.map(cat => cat.id);
                        categoriaSelect.val(categoriasSelecionadas).trigger("change"); // Marca categorias existentes
                    }

                    // Exibe o modal
                    let modal = new bootstrap.Modal(document.getElementById('modalEditarProduto'));
                    modal.show();
                }





                window.openModalEdit = openModalEdit;
                // Fun√ß√£o para excluir um produto (exemplo)
                function excluirProduto(produtoId) {
                    if (confirm(`Tem certeza que deseja excluir o produto ID: ${produtoId}?`)) {
                        fetch(`http://127.0.0.1:8000/api/produtos/${produtoId}`, {
                            method: 'DELETE',
                        })
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('Erro ao excluir o produto');
                                }
                                alert("Produto exclu√≠do com sucesso!");
                                buscarProdutos(selectLojas.value); // Atualiza a lista de produtos
                            })
                            .catch(error => {
                                console.error("Erro ao excluir produto:", error);
                                alert("Erro ao excluir produto.");
                            });
                    }
                }

                function salvarEdicaoProduto() {
                    let produtoId = document.getElementById('modalProdutoId').value;
                    let nome = document.getElementById('modalNome').value;
                    let valor_unitario = document.getElementById('modalValor').value;
                    let descricao = document.getElementById('modalDescricao').value;
                    let imagem = document.getElementById('modalImagem').value;
                    let estoque = document.getElementById('modalEstoque').value;

                    // Obt√©m os IDs das categorias selecionadas no Select2
                    let categoriaIds = $("#modalCategoria").val();

                    let produtoEditado = {
                        nome: nome,
                        valor_unitario: parseFloat(valor_unitario),
                        descricao: descricao,
                        imagem: imagem,
                        ativo: 1,
                        categoria_ids: categoriaIds,
                        estoque: parseInt(estoque)
                    };

                    fetch(`http://127.0.0.1:8000/api/produtos/update/${produtoId}`, {
                        method: "PUT",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify(produtoEditado)
                    })
                        .then(response => response.json())
                        .then(data => {
                            console.log("Produto atualizado:", data);

                            // ‚úÖ Exibir mensagem de sucesso (Toast) por mais tempo
                            let toastElement = document.getElementById("toastSuccess");
                            let toast = new bootstrap.Toast(toastElement, { delay: 3000 }); // Mostra por 3 segundos
                            toast.show();

                            // ‚úÖ Fechar o modal ap√≥s a exibi√ß√£o do toast
                            setTimeout(() => {
                                let modalEditar = new bootstrap.Modal(document.getElementById('modalEditarProduto'));
                                modalEditar.hide();
                            }, 2000); // Aguarda 2 segundos antes de fechar

                            // ‚úÖ Atualizar listagem da loja sem recarregar a p√°gina
                            let lojaSelecionada = document.getElementById("store-select").value;
                            if (lojaSelecionada) {
                                buscarProdutoss(lojaSelecionada);
                            }
                        })
                        .catch(error => console.error("Erro ao editar produto:", error));
                }
                function closeModal() {
                    $('#modalEditarProduto').modal('hide');
                }

            </script>

            </table>
        </div>
        <script src="sidebar.js"></script>

        <script>
            document.getElementById("store-select").addEventListener("change", function () {
                let productSection = document.getElementById("product-section");
                if (this.value) {
                    productSection.classList.remove("hidden");
                } else {
                    productSection.classList.add("hidden");
                }
            });
        </script>


</body>

</html>